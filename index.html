<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…ÙØªÙˆØ­ | Ù¾Ù„ØªÙØ±Ù… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¢Ú¯Ù‡ÛŒ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', 'Tajawal', sans-serif;
        }

        /* ========== ØªÙ…â€ŒÙ‡Ø§ ========== */
        :root[data-theme="dark"] {
            --primary: #1e3a8a;
            --accent: #f97316;
            --gold: #fbbf24;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --text-dim: #94a3b8;
            --border: #334155;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        :root[data-theme="light"] {
            --primary: #2563eb;
            --accent: #ea580c;
            --gold: #d97706;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #1f2937;
            --text-dim: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="royal"] {
            --primary: #7e22ce;
            --accent: #c2410c;
            --gold: #eab308;
            --bg: #2e1065;
            --card: #4c1d95;
            --text: #f5f3ff;
            --text-dim: #c4b5fd;
            --border: #6d28d9;
            --shadow: 0 4px 6px rgba(126, 34, 206, 0.3);
        }

        :root[data-theme="ocean"] {
            --primary: #0891b2;
            --accent: #f59e0b;
            --gold: #fbbf24;
            --bg: #164e63;
            --card: #155e75;
            --text: #ecfeff;
            --text-dim: #a5f3fc;
            --border: #06b6d4;
            --shadow: 0 4px 6px rgba(8, 145, 178, 0.3);
        }

        :root[data-theme="gold"] {
            --primary: #b45309;
            --accent: #f59e0b;
            --gold: #fbbf24;
            --bg: #78350f;
            --card: #92400e;
            --text: #fffbeb;
            --text-dim: #fcd34d;
            --border: #b45309;
            --shadow: 0 4px 6px rgba(180, 83, 9, 0.3);
        }

        body {
            background: var(--bg);
            color: var(--text);
            transition: background 0.3s, color 0.3s;
            padding: 16px;
            padding-bottom: 80px;
        }

        /* ========== ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ ========== */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--card);
            padding: 10px;
            border-radius: 50px;
            border: 1px solid var(--border);
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 30px;
            cursor: pointer;
            transition: 0.2s;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ========== Ú©Ø§Ø±ÙˆØ³Ù„ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ù…ØªØ­Ø±Ú© ========== */
        .special-carousel {
            background: linear-gradient(135deg, var(--gold), var(--accent));
            padding: 20px 0;
            border-radius: 30px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow);
        }

        .carousel-track {
            display: flex;
            animation: scroll 20s linear infinite;
            gap: 20px;
        }

        .carousel-track:hover {
            animation-play-state: paused;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .special-slide {
            min-width: 280px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 15px;
            border: 2px solid var(--gold);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            margin: 0 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        .special-slide:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--gold);
        }

        .special-slide .badge {
            background: var(--gold);
            color: black;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .special-slide h3 {
            color: white;
            margin-bottom: 5px;
        }

        .special-slide .price {
            color: var(--gold);
            font-size: 1.3rem;
            font-weight: 900;
        }

        /* ========== Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª Ø§Ø´ØªØ±Ø§Ú© (ØªØ¨Ù„ÛŒØº Ù†ÛŒØ³Øª) ========== */
        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .price-card {
            background: var(--card);
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: 0.2s;
        }

        .price-card:hover {
            transform: translateY(-2px);
            border-color: var(--gold);
        }

        .price-card .month {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--gold);
        }

        .price-card .amount {
            font-size: 1.2rem;
            font-weight: 900;
            margin: 10px 0;
        }

        .price-card .currency {
            color: var(--text-dim);
            font-size: 0.8rem;
        }

        /* ========== Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ ========== */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .category-item {
            background: var(--card);
            border-radius: 20px;
            padding: 15px 5px;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid var(--border);
        }

        .category-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .category-item i {
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 5px;
        }

        .category-item span {
            font-size: 0.7rem;
            display: block;
        }

        .category-item.active {
            background: var(--primary);
            color: white;
        }

        .category-item.active i {
            color: white;
        }

        /* ========== Ø¬Ø³ØªØ¬Ùˆ ========== */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box {
            width: 100%;
            padding: 15px 45px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 30px;
            color: var(--text);
            font-size: 1rem;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-dim);
        }

        .search-clear {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-dim);
            cursor: pointer;
            display: none;
        }

        /* ========== Ø´Ø¨Ú©Ù‡ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ ========== */
        .ads-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .ad-card {
            background: var(--card);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: 0.2s;
        }

        .ad-card.special {
            border: 2px solid var(--gold);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
        }

        .ad-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .ad-content {
            padding: 15px;
        }

        .ad-title {
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            color: var(--primary);
            cursor: pointer;
            font-size: 0.8rem;
        }

        .ad-price {
            color: var(--accent);
            font-weight: 900;
            font-size: 1.1rem;
            margin: 5px 0;
        }

        .price-options {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .ad-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-dim);
            font-size: 0.7rem;
            margin-top: 10px;
        }

        .translate-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 0.7rem;
            cursor: pointer;
        }

        /* ========== Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ========== */
        .admin-panel {
            background: var(--card);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid var(--gold);
        }

        .admin-section {
            margin-bottom: 20px;
        }

        .admin-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--gold);
        }

        .price-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .price-input {
            flex: 1;
            min-width: 100px;
            padding: 10px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
        }

        .save-btn {
            background: var(--gold);
            color: black;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
        }

        .pending-item {
            background: var(--bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .pending-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .approve-btn {
            background: green;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 15px;
            cursor: pointer;
        }

        .reject-btn {
            background: red;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 15px;
            cursor: pointer;
        }

        /* ========== Ù†Ø§ÙˆØ¨Ø±ÛŒ ========== */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: var(--card);
            display: flex;
            border-top: 1px solid var(--border);
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            color: var(--text-dim);
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary);
        }

        /* ========== Ù…ÙˆØ¯Ø§Ù„ ========== */
        .modal {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 1000;
            overflow-y: auto;
            display: none;
        }

        .modal-header {
            position: sticky;
            top: 0;
            background: var(--card);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid var(--border);
        }

        .back-btn {
            font-size: 1.5rem;
            cursor: pointer;
        }

        .loader {
            text-align: center;
            padding: 50px;
            color: var(--text-dim);
        }

        /* Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ */
        .limit-badge {
            background: var(--gold);
            color: black;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            display: inline-block;
            margin-bottom: 10px;
        }
    </style>
</head>
<body data-theme="dark">

    <!-- ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab('ads')">ğŸ  Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§</div>
        <div class="tab" onclick="switchTab('special')">âœ¨ ÙˆÛŒÚ˜Ù‡</div>
        <div class="tab" onclick="switchTab('vip')">ğŸ‘‘ VIP</div>
        <div class="tab" onclick="switchTab('admin')">âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª</div>
    </div>

    <!-- ØªØ¨ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ -->
    <div id="tab-ads" class="tab-content active">
        <!-- Ú©Ø§Ø±ÙˆØ³Ù„ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ù…ØªØ­Ø±Ú© (Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡) -->
        <div class="special-carousel">
            <div class="carousel-track" id="special-carousel-track"></div>
        </div>

        <!-- Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ -->
        <div class="category-grid">
            <div class="category-item active" onclick="filterCategory('all', this)">
                <i class="fas fa-border-all"></i>
                <span>Ù‡Ù…Ù‡</span>
            </div>
            <div class="category-item" onclick="filterCategory('Ø®ÙˆØ¯Ø±Ùˆ', this)">
                <i class="fas fa-car"></i>
                <span>Ø®ÙˆØ¯Ø±Ùˆ</span>
            </div>
            <div class="category-item" onclick="filterCategory('Ø§Ù…Ù„Ø§Ú©', this)">
                <i class="fas fa-home"></i>
                <span>Ø§Ù…Ù„Ø§Ú©</span>
            </div>
            <div class="category-item" onclick="filterCategory('Ø¯ÛŒØ¬ÛŒØªØ§Ù„', this)">
                <i class="fas fa-mobile-alt"></i>
                <span>Ø¯ÛŒØ¬ÛŒØªØ§Ù„</span>
            </div>
            <div class="category-item" onclick="filterCategory('Ø®Ø¯Ù…Ø§Øª', this)">
                <i class="fas fa-concierge-bell"></i>
                <span>Ø®Ø¯Ù…Ø§Øª</span>
            </div>
            <div class="category-item" onclick="filterCategory('Ù…ÙˆØ¨Ø§ÛŒÙ„', this)">
                <i class="fas fa-phone"></i>
                <span>Ù…ÙˆØ¨Ø§ÛŒÙ„</span>
            </div>
            <div class="category-item" onclick="filterCategory('Ù„Ù¾â€ŒØªØ§Ù¾', this)">
                <i class="fas fa-laptop"></i>
                <span>Ù„Ù¾â€ŒØªØ§Ù¾</span>
            </div>
            <div class="category-item" onclick="filterCategory('Ø­ÛŒÙˆØ§Ù†Ø§Øª', this)">
                <i class="fas fa-dog"></i>
                <span>Ø­ÛŒÙˆØ§Ù†Ø§Øª</span>
            </div>
        </div>

        <!-- Ø¬Ø³ØªØ¬Ùˆ -->
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-box" id="search-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§..." oninput="searchAds()">
            <i class="fas fa-times search-clear" id="search-clear" onclick="clearSearch()"></i>
        </div>

        <!-- Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ -->
        <div class="limit-badge" id="user-limit">
            <i class="fas fa-info-circle"></i> Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Û² Ø¢Ú¯Ù‡ÛŒ Ø¯Ø± Ù…Ø§Ù‡ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯
        </div>

        <!-- Ø´Ø¨Ú©Ù‡ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ -->
        <div id="ads-container" class="ads-grid"></div>
    </div>

    <!-- ØªØ¨ ÙˆÛŒÚ˜Ù‡ (Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ + Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§) -->
    <div id="tab-special" class="tab-content">
        <h2 style="margin-bottom: 15px;">âœ¨ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡</h2>
        <div id="special-ads-grid" class="ads-grid"></div>
    </div>

    <!-- ØªØ¨ VIP (Ø§Ø´ØªØ±Ø§Ú© ÙˆÛŒÚ˜Ù‡ + Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§) -->
    <div id="tab-vip" class="tab-content">
        <h2 style="margin-bottom: 15px;">ğŸ‘‘ Ø§Ø´ØªØ±Ø§Ú© ÙˆÛŒÚ˜Ù‡</h2>
        <div class="pricing-cards" id="vip-pricing-cards"></div>
        <div id="vip-requests"></div>
    </div>

    <!-- ØªØ¨ Ù…Ø¯ÛŒØ±ÛŒØª -->
    <div id="tab-admin" class="tab-content">
        <div class="admin-panel" id="admin-panel" style="display: none;">
            <div class="admin-section">
                <div class="admin-title">
                    <i class="fas fa-coins"></i>
                    <h3>ØªÙ†Ø¸ÛŒÙ… Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§</h3>
                </div>
                
                <h4>Ø¢Ú¯Ù‡ÛŒ ÙˆÛŒÚ˜Ù‡ (ØªÙˆÙ…Ø§Ù†)</h4>
                <div class="price-input-group">
                    <input type="text" class="price-input" id="price-special-1" placeholder="Û± Ø±ÙˆØ²Ù‡">
                    <input type="text" class="price-input" id="price-special-3" placeholder="Û³ Ø±ÙˆØ²Ù‡">
                </div>

                <h4>Ø§Ø´ØªØ±Ø§Ú© ÙˆÛŒÚ˜Ù‡</h4>
                <div class="price-input-group">
                    <input type="text" class="price-input" id="price-vip-1" placeholder="Û± Ù…Ø§Ù‡Ù‡">
                    <input type="text" class="price-input" id="price-vip-3" placeholder="Û³ Ù…Ø§Ù‡Ù‡">
                    <input type="text" class="price-input" id="price-vip-6" placeholder="Û¶ Ù…Ø§Ù‡Ù‡">
                </div>

                <button class="save-btn" onclick="savePrices()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§</button>
            </div>

            <div class="admin-section">
                <div class="admin-title">
                    <i class="fas fa-clock"></i>
                    <h3>Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ Ù†Ø´Ø¯Ù‡</h3>
                </div>
                <div id="pending-requests"></div>
            </div>
        </div>
        <div id="non-admin-message" style="text-align: center; padding: 50px;">
            <i class="fas fa-lock fa-3x" style="color: var(--text-dim);"></i>
            <p>Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ± Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø³Øª.</p>
        </div>
    </div>

    <!-- Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù¾Ø§ÛŒÛŒÙ† (Ø§Ø®ØªÛŒØ§Ø±ÛŒ) -->
    <div class="nav">
        <div class="nav-item" onclick="switchTab('ads')">
            <i class="fas fa-home"></i>
            <span>Ø®Ø§Ù†Ù‡</span>
        </div>
        <div class="nav-item" onclick="openBot()">
            <i class="fas fa-plus-circle"></i>
            <span>Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ</span>
        </div>
        <div class="nav-item" onclick="openSupport()">
            <i class="fas fa-headset"></i>
            <span>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</span>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¢Ú¯Ù‡ÛŒ -->
    <div id="ad-modal" class="modal">
        <div class="modal-header">
            <i class="fas fa-arrow-right back-btn" onclick="closeModal()"></i>
            <h3>Ø¬Ø²Ø¦ÛŒØ§Øª Ø¢Ú¯Ù‡ÛŒ</h3>
        </div>
        <div class="modal-content" id="modal-content"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let currentUser = null;
        let isAdmin = false;
        let allAds = [];
        let currentCategory = 'all';
        let currentSearch = '';
        let userAdsCount = 0;
        let prices = {
            special1: 'Û±Û°,Û°Û°Û°',
            special3: 'Û²Ûµ,Û°Û°Û°',
            vip1: 'ÛµÛ°,Û°Û°Û°',
            vip3: 'Û±Û³Û°,Û°Û°Û°',
            vip6: 'Û²Û´Û°,Û°Û°Û°'
        };

        // ========== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ ==========
        async function init() {
            const userId = tg.initDataUnsafe?.user?.id;
            if (userId) {
                // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¨ÙˆØ¯Ù†
                isAdmin = (userId === 6522877528); // Ø¢ÛŒØ¯ÛŒ Ø§Ø¯Ù…ÛŒÙ†
                if (isAdmin) {
                    document.getElementById('admin-panel').style.display = 'block';
                    document.getElementById('non-admin-message').style.display = 'none';
                }

                // Ø¯Ø±ÛŒØ§ÙØª ØªØ¹Ø¯Ø§Ø¯ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø§ÛŒÙ† Ù…Ø§Ù‡
                await getUserAdsCount(userId);
            }

            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§
            await fetchAds();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
            loadPrices();
            
            // Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª
            renderPricingCards();
        }

        // ========== Ø¯Ø±ÛŒØ§ÙØª ØªØ¹Ø¯Ø§Ø¯ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± ==========
        async function getUserAdsCount(userId) {
            try {
                const response = await fetch(`https://souq-bot.mehdi11eidani.workers.dev/user-ads-count?user_id=${userId}&month=${new Date().getMonth()}`);
                const data = await response.json();
                userAdsCount = data.count || 0;
                document.getElementById('user-limit').innerHTML = `Ø´Ù…Ø§ ${userAdsCount} Ø§Ø² Û² Ø¢Ú¯Ù‡ÛŒ Ø§ÛŒÙ† Ù…Ø§Ù‡ Ø±Ø§ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.`;
            } catch (e) {
                console.log(e);
            }
        }

        // ========== Ø¯Ø±ÛŒØ§ÙØª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ ==========
        async function fetchAds() {
            try {
                const response = await fetch('https://souq-bot.mehdi11eidani.workers.dev/ads');
                const data = await response.json();
                allAds = data.ads || [];
                renderSpecialCarousel();
                renderAds();
                renderSpecialAdsTab();
            } catch (e) {
                console.log(e);
            }
        }

        // ========== Ú©Ø§Ø±ÙˆØ³Ù„ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ù…ØªØ­Ø±Ú© ==========
        function renderSpecialCarousel() {
            const specialAds = allAds.filter(ad => ad.ad_type === 'special').slice(0, 10);
            const track = document.getElementById('special-carousel-track');
            
            if (specialAds.length === 0) {
                track.innerHTML = '<div class="special-slide">Ø¢Ú¯Ù‡ÛŒ ÙˆÛŒÚ˜Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';
                return;
            }

            // Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØªØŒ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ùˆ Ø¨Ø§Ø± ØªÚ©Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            const adsToShow = [...specialAds, ...specialAds];
            track.innerHTML = adsToShow.map(ad => `
                <div class="special-slide" onclick="showAdDetail(${JSON.stringify(ad).replace(/"/g, '&quot;')})">
                    <span class="badge">âœ¨ ÙˆÛŒÚ˜Ù‡ ${ad.plan_days || 1} Ø±ÙˆØ²Ù‡</span>
                    <h3>${ad.title}</h3>
                    <div class="price">${ad.price} ${ad.currency}</div>
                    <div style="font-size:0.7rem;">${ad.city}ØŒ ${ad.country}</div>
                </div>
            `).join('');
        }

        // ========== Ù†Ù…Ø§ÛŒØ´ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ ==========
        function renderAds() {
            let filteredAds = allAds.filter(ad => ad.ad_type !== 'special');

            if (currentCategory !== 'all') {
                filteredAds = filteredAds.filter(ad => ad.cat === currentCategory);
            }

            if (currentSearch) {
                filteredAds = filteredAds.filter(ad => 
                    ad.title.includes(currentSearch) || 
                    ad.description.includes(currentSearch)
                );
            }

            const container = document.getElementById('ads-container');
            if (filteredAds.length === 0) {
                container.innerHTML = '<div class="loader">Ø¢Ú¯Ù‡ÛŒâ€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                return;
            }

            container.innerHTML = filteredAds.map(ad => `
                <div class="ad-card ${ad.ad_type === 'special' ? 'special' : ''}" onclick="showAdDetail(${JSON.stringify(ad).replace(/"/g, '&quot;')})">
                    <img src="${ad.image_ids ? 'https://api.telegram.org/file/bot8587925383:AAElQXNbZ8YIDJMWwX4YyVFMCOsC2pV6H6c/' + JSON.parse(ad.image_ids)[0] : 'https://via.placeholder.com/300'}" 
                         class="ad-image" 
                         onerror="this.src='https://via.placeholder.com/300'">
                    <div class="ad-content">
                        <div class="ad-title">
                            <span>${ad.title}</span>
                            <i class="far fa-copy copy-btn" onclick="copyText('${ad.title} - ${ad.description} - Ù‚ÛŒÙ…Øª: ${ad.price} ${ad.currency}', event)"></i>
                        </div>
                        <div class="ad-price">${ad.price}</div>
                        <div class="price-options">
                            <span>ğŸ’° ${ad.price} ØªÙˆÙ…Ø§Ù†</span>
                            <span>ğŸ’µ ${Math.floor(ad.price / 60000)}$ Ø¯Ù„Ø§Ø±</span>
                            <span>ğŸ’ ${Math.floor(ad.price / 60000)} USDT</span>
                        </div>
                        <div class="ad-meta">
                            <span>${ad.city}ØŒ ${ad.country}</span>
                            <span>${new Date(ad.created_at * 1000).toLocaleDateString('fa-IR')}</span>
                        </div>
                        <button class="translate-btn" onclick="translateText('${ad.description}', event)">ØªØ±Ø¬Ù…Ù‡</button>
                    </div>
                </div>
            `).join('');
        }

        // ========== Ù†Ù…Ø§ÛŒØ´ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ø¯Ø± ØªØ¨ Ø¬Ø¯Ø§ ==========
        function renderSpecialAdsTab() {
            const specialAds = allAds.filter(ad => ad.ad_type === 'special');
            const container = document.getElementById('special-ads-grid');
            
            if (specialAds.length === 0) {
                container.innerHTML = '<div class="loader">Ø¢Ú¯Ù‡ÛŒ ÙˆÛŒÚ˜Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>';
                return;
            }

            container.innerHTML = specialAds.map(ad => `
                <div class="ad-card special" onclick="showAdDetail(${JSON.stringify(ad).replace(/"/g, '&quot;')})">
                    <img src="${ad.image_ids ? 'https://api.telegram.org/file/bot8587925383:AAElQXNbZ8YIDJMWwX4YyVFMCOsC2pV6H6c/' + JSON.parse(ad.image_ids)[0] : 'https://via.placeholder.com/300'}" 
                         class="ad-image" 
                         onerror="this.src='https://via.placeholder.com/300'">
                    <div class="ad-content">
                        <span class="badge">âœ¨ ÙˆÛŒÚ˜Ù‡ ${ad.plan_days || 1} Ø±ÙˆØ²Ù‡</span>
                        <div class="ad-title">${ad.title}</div>
                        <div class="ad-price">${ad.price}</div>
                        <div class="ad-meta">
                            <span>${ad.city}ØŒ ${ad.country}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ========== Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª Ø§Ø´ØªØ±Ø§Ú© ==========
        function renderPricingCards() {
            const cards = [
                { months: 1, price: prices.vip1 },
                { months: 3, price: prices.vip3 },
                { months: 6, price: prices.vip6 }
            ];

            const container = document.getElementById('vip-pricing-cards');
            container.innerHTML = cards.map(card => `
                <div class="price-card" onclick="buySubscription(${card.months})">
                    <div class="month">${card.months} Ù…Ø§Ù‡Ù‡</div>
                    <div class="amount">${card.price}</div>
                    <div class="currency">ØªÙˆÙ…Ø§Ù†</div>
                </div>
            `).join('');
        }

        // ========== Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© ==========
        function buySubscription(months) {
            tg.openTelegramLink(`https://t.me/AlsouqAlmaftuhiran_bot?start=subscribe_${months}`);
        }

        // ========== Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¢Ú¯Ù‡ÛŒ ==========
        function showAdDetail(ad) {
            const modal = document.getElementById('ad-modal');
            const content = document.getElementById('modal-content');
            
            const firstImage = ad.image_ids ? 
                'https://api.telegram.org/file/bot8587925383:AAElQXNbZ8YIDJMWwX4YyVFMCOsC2pV6H6c/' + JSON.parse(ad.image_ids)[0] : 
                'https://via.placeholder.com/600';

            content.innerHTML = `
                <img src="${firstImage}" style="width:100%; border-radius:20px; margin-bottom:20px;">
                <h2>${ad.title}</h2>
                <div style="font-size:1.5rem; color:var(--accent); margin:15px 0;">${ad.price}</div>
                <div class="price-options" style="margin-bottom:20px;">
                    <span>ğŸ’° ${ad.price} ØªÙˆÙ…Ø§Ù†</span>
                    <span>ğŸ’µ ${Math.floor(ad.price / 60000)}$</span>
                    <span>ğŸ’ ${Math.floor(ad.price / 60000)} USDT</span>
                </div>
                <p style="margin:20px 0;">${ad.description}</p>
                <div style="background:var(--card); padding:15px; border-radius:15px;">
                    <p>ğŸ“ ${ad.city}ØŒ ${ad.country}</p>
                    <p>ğŸ“… ${new Date(ad.created_at * 1000).toLocaleDateString('fa-IR')}</p>
                </div>
                <button class="copy-btn" style="width:100%; margin-top:20px;" onclick="copyText('${ad.title} - ${ad.description} - Ù‚ÛŒÙ…Øª: ${ad.price} ${ad.currency}')">
                    <i class="far fa-copy"></i> Ú©Ù¾ÛŒ Ù…ØªÙ† Ø¢Ú¯Ù‡ÛŒ
                </button>
            `;
            
            modal.style.display = 'block';
            tg.BackButton.show();
        }

        // ========== Ú©Ù¾ÛŒ Ù…ØªÙ† ==========
        function copyText(text, event) {
            if (event) event.stopPropagation();
            navigator.clipboard.writeText(text);
            tg.showPopup({ message: 'âœ… Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯' });
        }

        // ========== ØªØ±Ø¬Ù…Ù‡ Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ==========
        async function translateText(text, event) {
            if (event) event.stopPropagation();
            event.target.innerText = 'Ø¯Ø± Ø­Ø§Ù„ ØªØ±Ø¬Ù…Ù‡...';
            
            try {
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ±Ø¬Ù…Ù‡ Ø¨Ø§ API Ø±Ø§ÛŒÚ¯Ø§Ù† (Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ø³Ø±ÙˆÛŒØ³ ÙˆØ§Ù‚Ø¹ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯)
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=fa|en`);
                const data = await response.json();
                const translated = data.responseData.translatedText;
                
                tg.showPopup({ 
                    title: 'ØªØ±Ø¬Ù…Ù‡',
                    message: translated,
                    buttons: [{ type: 'close' }]
                });
            } catch (e) {
                tg.showPopup({ message: 'Ø®Ø·Ø§ Ø¯Ø± ØªØ±Ø¬Ù…Ù‡' });
            }
            
            event.target.innerText = 'ØªØ±Ø¬Ù…Ù‡';
        }

        // ========== ÙÛŒÙ„ØªØ± Ø¯Ø³ØªÙ‡ ==========
        function filterCategory(cat, element) {
            currentCategory = cat;
            document.querySelectorAll('.category-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            renderAds();
        }

        // ========== Ø¬Ø³ØªØ¬Ùˆ ==========
        function searchAds() {
            currentSearch = document.getElementById('search-input').value;
            document.getElementById('search-clear').style.display = currentSearch ? 'block' : 'none';
            renderAds();
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            searchAds();
        }

        // ========== Ø°Ø®ÛŒØ±Ù‡ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ (Ø§Ø¯Ù…ÛŒÙ†) ==========
        function savePrices() {
            prices = {
                special1: document.getElementById('price-special-1').value,
                special3: document.getElementById('price-special-3').value,
                vip1: document.getElementById('price-vip-1').value,
                vip3: document.getElementById('price-vip-3').value,
                vip6: document.getElementById('price-vip-6').value
            };
            localStorage.setItem('prices', JSON.stringify(prices));
            renderPricingCards();
            tg.showPopup({ message: 'Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯' });
        }

        function loadPrices() {
            const saved = localStorage.getItem('prices');
            if (saved) {
                prices = JSON.parse(saved);
            }
            
            document.getElementById('price-special-1').value = prices.special1;
            document.getElementById('price-special-3').value = prices.special3;
            document.getElementById('price-vip-1').value = prices.vip1;
            document.getElementById('price-vip-3').value = prices.vip3;
            document.getElementById('price-vip-6').value = prices.vip6;
        }

        // ========== ØªØºÛŒÛŒØ± ØªØ¨ ==========
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        // ========== Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø±Ø¨Ø§Øª ==========
        function openBot() {
            tg.openTelegramLink('https://t.me/AlsouqAlmaftuhiran_bot?start=postad');
        }

        function openSupport() {
            tg.openTelegramLink('https://t.me/Mehdi_E_admin');
        }

        function closeModal() {
            document.getElementById('ad-modal').style.display = 'none';
            tg.BackButton.hide();
        }

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        init();

        // Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª ØªÙ„Ú¯Ø±Ø§Ù…
        tg.BackButton.onClick(() => {
            if (document.getElementById('ad-modal').style.display === 'block') {
                closeModal();
            }
        });
    </script>
</body>
</html>
