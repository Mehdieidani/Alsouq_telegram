<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>اختبار فتح البوت</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #0c0f1c; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 20px; direction: rtl; }
        button { background: #daa520; border: none; border-radius: 30px; padding: 15px 25px; margin: 10px; font-size: 18px; font-weight: bold; color: black; cursor: pointer; width: 250px; }
        .link-box { background: #1e1e2f; padding: 15px; border-radius: 10px; margin-top: 30px; width: 100%; max-width: 400px; text-align: center; }
        input { width: 100%; padding: 10px; border-radius: 5px; border: none; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>اختبار فتح البوت</h1>
    <button id="openBotBtn1">فتح البوت (طريقة 1)</button>
    <button id="openBotBtn2">فتح البوت (طريقة 2)</button>
    
    <div class="link-box">
        <p>إذا لم يعمل الزر، انسخ الرابط يدويًا:</p>
        <input type="text" id="botLink" value="https://t.me/AlsouqAlmaftuhiran_bot" readonly>
        <button id="copyLinkBtn">نسخ الرابط</button>
    </div>

    <script>
        const BOT_USERNAME = 'AlsouqAlmaftuhiran_bot';
        const tg = window.Telegram?.WebApp;
        const isTelegram = !!tg;

        // الروابط المختلفة للتجربة
        const botUrls = [
            `https://t.me/${BOT_USERNAME}`,
            `tg://resolve?domain=${BOT_USERNAME}`,
            `https://telegram.me/${BOT_USERNAME}`
        ];

        // دالة فتح الرابط بطرق متعددة
        function openBotUrl(url) {
            console.log('محاولة فتح:', url);
            try {
                if (isTelegram && tg?.openTelegramLink) {
                    tg.openTelegramLink(url);
                } else {
                    // محاولة فتح الرابط في نافذة جديدة
                    const newWindow = window.open(url, '_blank');
                    if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                        // إذا تم حظر النافذة المنبثقة، نحاول فتحه في نفس النافذة
                        window.location.href = url;
                    }
                }
            } catch (e) {
                console.error('خطأ في فتح الرابط:', e);
                // كملاذ أخير، نستخدم الطريقة القديمة
                window.location.href = url;
            }
        }

        // الزر الأول - يحاول جميع الروابط بالتسلسل
        document.getElementById('openBotBtn1').addEventListener('click', function() {
            for (let url of botUrls) {
                openBotUrl(url);
            }
        });

        // الزر الثاني - يستخدم الرابط الأساسي فقط
        document.getElementById('openBotBtn2').addEventListener('click', function() {
            openBotUrl(botUrls[0]);
        });

        // نسخ الرابط
        document.getElementById('copyLinkBtn').addEventListener('click', function() {
            const linkInput = document.getElementById('botLink');
            linkInput.select();
            document.execCommand('copy');
            alert('تم نسخ الرابط: ' + linkInput.value);
        });
    </script>
</body>
</html>
